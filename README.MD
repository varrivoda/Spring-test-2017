# ПРОКЛЯТИЕ SPRING TEST
Конспект выступления Е.Борисова и К.Толкачева на JPoint-2017
https://youtu.be/7mZqJShu_3c

    "..данный доклад не стоит записывать и воспринимать как cooking book, т.к. некоторыые вещи специадльно делаем неправильно, чтобы логически прийти к тому,как это делать правильно" 
-Борисов об импорте конфигураций на 14:00

# Сегодня в программе: Тестирование живого приложения:
-Старые подходы:
    @ContextConfiguration
    @ContextHierarchy && @DirtiesContext
    @ActiveProfiles
-Что нового от Spring Boot?
    @SpringBootTest
    @TestConfiguration
    @MockBean && @SpyBean && @*Beans
    @DataJpaTest
    @WebMvcTest
-Кеширование spring контекстов
-Шкала тестов

Мы не можем дать какой-то единой правильной методологии по TDD и показать все связанные с этим современные спринговые штуки. Цель доклада - показать технические возможности тестировать разные куски нашего микросервисы, ну и после всего этого поделиться определенными концепциями по поводу всего этого.

Какие тесты мы будем писать? 
Вообще на "шкале тестов" можно выделить следубщие масштабы:
    
    Unit -> Component -->-->--> Microservice -> System test 

Есть обычные юнит-тесты, которым ничего ненужно: через new созлаем объект, обкладываем все моками, тут всё понятно и без нас.

Следующий уровень - component-test,  это уже некая часть системы -например, у нас есть сервис, в который инжектится Дао, это работает с какой-то моковой БД... Компонентможет быть разного размера,например контроллер скаким-то сервисом..

Иесть утв-to-end тест, т е тест всего микросервиса, полностью от контроллера до базы,иединственноечто будет мокироваться- это все его выходы, например к другим системам/микросервисам.

Последний - System test - сегодня рассматривать не будем.

# ЧАСТЬ 1, условия задачи

Наше приложение,которое мы будем тестировать - это чат поддержки, в котором есть эксперты, которые помогают разработчикам отвечать на вопросы.
                                   
                              ---  ???? --- 
                            |default answers| 
                            |   database    |
                              -- _______ --
                                    ^
     ______             ____________v__
    |__мы__| <--web--> |___assistant___| <----.
                        ^             |       |   
                      rest           rest    rest
              __________v______    ___v_______|______
             |jbaruch-assistant|  |yegor256-assistant| <--> Queue

Мы приходим в чат,и должны задать какой-то вопрос, и нам отвечает один из экспертов. 
asistant-сервис работает как роутер: получает вопрос, по ключевым словам понимает,ккакому эксперту обратиться, если ноль совпадений по ключевым словам онидет в базу дефолтных ответов.

Барух отвечает всегда одинаково, поэтому его ответы можно закешировать, и поэтому он отвечает гораздо быстрее. А Егор откладывает все свои вопросы в очередь, думает, надругой раз может и передумать и ответить отлично от прошлого раза, поэтому его ответы кешировать нельзя. 

